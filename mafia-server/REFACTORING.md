# π­ Mafia Server - λ¦¬ν©ν† λ§ μ™„λ£

## π“‹ κ°μ”

Mafia University μ„λ²„ μ½”λ“λ¥Ό κ°μ²΄μ§€ν–¥ μ›μΉ™(SOLID)μ— λ”°λΌ μ™„μ „ν λ¦¬ν©ν† λ§ν–μµλ‹λ‹¤.

### λ¦¬ν©ν† λ§ μ „ vs ν›„

| ν•­λ© | λ¦¬ν©ν† λ§ μ „ | λ¦¬ν©ν† λ§ ν›„ |
|------|------------|------------|
| νμΌ μ | 3κ° | 20κ° |
| μµλ€ νμΌ ν¬κΈ° | 787μ¤„ (index.ts) | μ•½ 250μ¤„ |
| κµ¬μ΅° | μ μ°¨μ , λ¨λ†€λ¦¬μ‹ | κ³„μΈµν™”, λ¨λ“ν™” |
| μ±…μ„ λ¶„λ¦¬ | μ—†μ | λ…ν™•ν•¨ |
| ν…μ¤νΈ κ°€λ¥μ„± | λ‚®μ | λ†’μ |
| ν™•μ¥μ„± | λ‚®μ | λ†’μ |

## π—οΈ μƒλ΅μ΄ μ•„ν‚¤ν…μ²

### ν΄λ” κµ¬μ΅°

```
mafia-server/src/
β”β”€β”€ core/                          # μ„λ²„ μ½”μ–΄
β”‚   β”β”€β”€ Server.ts                  # Express, Socket.IO, Supabase μ΄κΈ°ν™”
β”‚   β””β”€β”€ SocketManager.ts           # Socket.IO μ—°κ²° κ΄€λ¦¬
β”‚
β”β”€β”€ domain/                        # λ„λ©”μΈ λ μ΄μ–΄ (λΉ„μ¦λ‹μ¤ λ΅μ§)
β”‚   β”β”€β”€ entities/                  # μ—”ν‹°ν‹° (λ°μ΄ν„° + ν–‰μ„)
β”‚   β”‚   β”β”€β”€ Player.ts             # ν”λ μ΄μ–΄ μ—”ν‹°ν‹°
β”‚   β”‚   β”β”€β”€ Room.ts               # λ°© μ—”ν‹°ν‹°
β”‚   β”‚   β””β”€β”€ Game.ts               # κ²μ„ μ—”ν‹°ν‹°
β”‚   β”‚
β”‚   β”β”€β”€ repositories/              # λ°μ΄ν„° μ €μ¥μ† (Repository Pattern)
β”‚   β”‚   β”β”€β”€ RoomRepository.ts     # λ°© μ €μ¥μ†
β”‚   β”‚   β”β”€β”€ GameRepository.ts     # κ²μ„ μ €μ¥μ†
β”‚   β”‚   β””β”€β”€ PlayerSessionRepository.ts  # μ„Έμ… μ €μ¥μ†
β”‚   β”‚
β”‚   β””β”€β”€ services/                  # λΉ„μ¦λ‹μ¤ λ΅μ§ μ„λΉ„μ¤
β”‚       β”β”€β”€ RoomService.ts        # λ°© κ΄€λ¦¬ λ΅μ§
β”‚       β”β”€β”€ GameService.ts        # κ²μ„ λ΅μ§
β”‚       β”β”€β”€ GameActionService.ts  # κ²μ„ μ•΅μ… (ν‚¬, μ΅°μ‚¬, λ³΄νΈ)
β”‚       β””β”€β”€ RoleService.ts        # μ—­ν•  κ΄€λ¦¬
β”‚
β”β”€β”€ events/                        # μ΄λ²¤νΈ λ μ΄μ–΄
β”‚   β”β”€β”€ handlers/                  # μ΄λ²¤νΈ ν•Έλ“¤λ¬
β”‚   β”‚   β”β”€β”€ RoomEventHandler.ts   # λ°© κ΄€λ ¨ μ΄λ²¤νΈ
β”‚   β”‚   β”β”€β”€ GameEventHandler.ts   # κ²μ„ ν”λ μ΄ μ΄λ²¤νΈ
β”‚   β”‚   β”β”€β”€ MeetingEventHandler.ts # νμ/ν¬ν‘ μ΄λ²¤νΈ
β”‚   β”‚   β””β”€β”€ PlayerEventHandler.ts # ν”λ μ΄μ–΄ μ΄λ²¤νΈ
β”‚   β”‚
β”‚   β””β”€β”€ EventRouter.ts            # μ΄λ²¤νΈ λΌμ°ν…
β”‚
β”β”€β”€ types/                         # νƒ€μ… μ •μ
β”‚   β”β”€β”€ GameTypes.ts              # κ²μ„ κ΄€λ ¨ νƒ€μ…
β”‚   β””β”€β”€ RoomTypes.ts              # λ°© κ΄€λ ¨ νƒ€μ…
β”‚
β””β”€β”€ index.ts                       # μ—”νΈλ¦¬ ν¬μΈνΈ (DI Container)
```

## π― μ μ©λ κ°μ²΄μ§€ν–¥ μ›μΉ™

### 1. SRP (Single Responsibility Principle) - λ‹¨μΌ μ±…μ„ μ›μΉ™
- κ° ν΄λμ¤λ” ν•λ‚μ μ±…μ„λ§ κ°€μ§
- μ: `RoomService`λ” λ°© κ΄€λ¦¬λ§, `GameService`λ” κ²μ„ λ΅μ§λ§ λ‹΄λ‹Ή

### 2. OCP (Open/Closed Principle) - κ°λ°©-νμ‡„ μ›μΉ™
- ν™•μ¥μ—λ” μ—΄λ ¤μκ³  μμ •μ—λ” λ‹«ν€μμ
- Repository μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄ κµ¬ν„μ²΄ κµμ²΄ κ°€λ¥

### 3. LSP (Liskov Substitution Principle) - λ¦¬μ¤μ½”ν”„ μΉν™ μ›μΉ™
- μΈν„°νμ΄μ¤λ¥Ό ν†µν• μ¶”μƒν™”λ΅ λ€μ²΄ κ°€λ¥μ„± ν™•λ³΄
- μ: `IRoomRepository` μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• μ–΄λ–¤ Repositoryλ„ μ‚¬μ© κ°€λ¥

### 4. ISP (Interface Segregation Principle) - μΈν„°νμ΄μ¤ λ¶„λ¦¬ μ›μΉ™
- κ° μ„λΉ„μ¤λ” ν•„μ”ν• μμ΅΄μ„±λ§ μ£Όμ…λ°›μ
- λ¶ν•„μ”ν• μμ΅΄μ„± μ κ±°

### 5. DIP (Dependency Inversion Principle) - μμ΅΄μ„± μ—­μ „ μ›μΉ™
- κµ¬μ²΄μ  κµ¬ν„μ΄ μ•„λ‹ μ¶”μƒ(μΈν„°νμ΄μ¤)μ— μμ΅΄
- `index.ts`μ—μ„ μμ΅΄μ„± μ£Όμ… (Dependency Injection) μ‚¬μ©

## π”§ μ μ©λ λ””μμΈ ν¨ν„΄

### 1. Repository Pattern
- λ°μ΄ν„° μ ‘κ·Ό λ΅μ§μ„ μ¶”μƒν™”
- ν–¥ν›„ λ°μ΄ν„°λ² μ΄μ¤ κµμ²΄ μ©μ΄ (λ©”λ¨λ¦¬ β†’ PostgreSQL/MongoDB)

### 2. Service Layer Pattern
- λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ„λΉ„μ¤ λ μ΄μ–΄λ΅ λ¶„λ¦¬
- ν…μ¤νΈ λ° μ¬μ‚¬μ©μ„± ν–¥μƒ

### 3. Dependency Injection Pattern
- `index.ts`μ—μ„ λ¨λ“  μμ΅΄μ„±μ„ μ΅°λ¦½ν•κ³  μ£Όμ…
- λμ¨ν• κ²°ν•©(Loose Coupling) λ‹¬μ„±

### 4. Event Handler Pattern
- μ†μΌ“ μ΄λ²¤νΈλ¥Ό μ „λ¬Έμ μΌλ΅ μ²λ¦¬ν•λ” ν•Έλ“¤λ¬ λ¶„λ¦¬
- κ΄€μ‹¬μ‚¬ λ¶„λ¦¬ (Separation of Concerns)

## π“ μ£Όμ” κ°μ„  μ‚¬ν•­

### 1. μ½”λ“ μ‘μ§‘λ„ ν–¥μƒ
- κ΄€λ ¨λ κΈ°λ¥λ“¤μ΄ ν• κ³³μ— λ¨μ—¬μμ
- μ: λ¨λ“  λ°© κ΄€λ ¨ λ΅μ§μ€ `RoomService`μ— μ§‘μ¤‘

### 2. κ²°ν•©λ„ κ°μ†
- κ° μ»΄ν¬λ„νΈλ” μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄ λμ¨ν•κ² μ—°κ²°
- ν• λ¶€λ¶„μ λ³€κ²½μ΄ λ‹¤λ¥Έ λ¶€λ¶„μ— μν–¥μ„ μµμ†ν™”

### 3. ν…μ¤νΈ μ©μ΄μ„±
- κ° μ„λΉ„μ¤λ¥Ό λ…λ¦½μ μΌλ΅ ν…μ¤νΈ κ°€λ¥
- Mock κ°μ²΄λ¥Ό μ‰½κ² μ£Όμ… κ°€λ¥

### 4. ν™•μ¥μ„±
- μƒλ΅μ΄ κΈ°λ¥ μ¶”κ°€κ°€ μ©μ΄
- μ: μƒλ΅μ΄ μ—­ν•  μ¶”κ°€ μ‹ `RoleService`λ§ μμ •

### 5. μ μ§€λ³΄μμ„±
- μ½”λ“μ μ„μΉλ¥Ό μ‰½κ² μ°Ύμ„ μ μμ
- κ° νμΌμ μ±…μ„μ΄ λ…ν™•ν•¨

## π€ μ‹¤ν–‰ λ°©λ²•

### κ°λ° λ¨λ“
```bash
npm run dev
```

### ν”„λ΅λ•μ… λΉλ“
```bash
npm run build
npm start
```

## π”„ λ§μ΄κ·Έλ μ΄μ… λ…ΈνΈ

### λ°±μ—…λ νμΌ
- `src/gameLogic.ts.backup` - κΈ°μ΅΄ κ²μ„ λ΅μ§
- `src/roomManager.ts.backup` - κΈ°μ΅΄ λ°© κ΄€λ¦¬ λ΅μ§

### νΈν™μ„±
- λ¨λ“  μ†μΌ“ μ΄λ²¤νΈλ” λ™μΌν•κ² μ‘λ™
- ν”„λ΅ νΈμ—”λ“ μ½”λ“ λ³€κ²½ λ¶ν•„μ”
- API μ—”λ“ν¬μΈνΈ λ™μΌ

## π“ ν–¥ν›„ κ°μ„  λ°©ν–¥

1. **λ‹¨μ„ ν…μ¤νΈ μ¶”κ°€**
   - Jestλ¥Ό μ‚¬μ©ν• μ„λΉ„μ¤ λ μ΄μ–΄ ν…μ¤νΈ
   - Repository λ μ΄μ–΄ ν…μ¤νΈ

2. **λ΅κΉ… μ‹μ¤ν…**
   - Winston λλ” Pinoλ¥Ό μ‚¬μ©ν• κµ¬μ΅°ν™”λ λ΅κΉ…

3. **μ—λ¬ ν•Έλ“¤λ§**
   - μ»¤μ¤ν…€ μ—λ¬ ν΄λμ¤ μ¶”κ°€
   - μ¤‘μ•™ν™”λ μ—λ¬ μ²λ¦¬

4. **λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…**
   - Redisλ¥Ό μ‚¬μ©ν• μ„Έμ… κ΄€λ¦¬
   - PostgreSQLμ„ μ‚¬μ©ν• μκµ¬ μ €μ¥

5. **λ¨λ‹ν„°λ§**
   - Prometheus/Grafana λ©”νΈλ¦­ μμ§‘
   - APM λ„κµ¬ ν†µν•©

## π“ ν•™μµ ν¬μΈνΈ

μ΄ λ¦¬ν©ν† λ§μ„ ν†µν•΄ λ°°μΈ μ μλ” κ²ƒλ“¤:

1. **Clean Architecture**: κ³„μΈµν™”λ μ•„ν‚¤ν…μ² μ„¤κ³„
2. **SOLID μ›μΉ™**: μ‹¤μ „ μ μ© λ°©λ²•
3. **λ””μμΈ ν¨ν„΄**: Repository, Service Layer, DI ν¨ν„΄
4. **TypeScript**: κ³ κΈ‰ νƒ€μ… μ‹μ¤ν… ν™μ©
5. **μ½”λ“ μ΅°μ§ν™”**: λ€κ·λ¨ ν”„λ΅μ νΈ κµ¬μ΅°ν™”

---

**μ‘μ„±μΌ**: 2026-02-04  
**λ²„μ „**: 2.0.0  
**μ•„ν‚¤ν…μ²**: Clean Architecture + DDD + SOLID
